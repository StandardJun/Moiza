# ëª¨ì´ì (Moiza) - í”„ë¡œì íŠ¸ ë…¸íŠ¸

## í”„ë¡œì íŠ¸ ê°œìš”
ëª¨ì„ ì¶œì„ ì²´í¬ì™€ ë²Œê¸ˆ ìë™ ê³„ì‚° ì•±
- ìˆ˜ìµ ëª¨ë¸: ê´‘ê³  ê¸°ë°˜ (ëª¨ë°”ì¼: AdMob, ì›¹: AdSense)

## í˜„ì¬ ìƒíƒœ: Cloudflare Pages ë°°í¬ ì™„ë£Œ âœ…

---

## ê¸°ìˆ  ìŠ¤íƒ
- **Frontend**: Flutter (iOS, Android, Web)
- **Backend**: Firebase (Auth, Firestore)
- **State Management**: Provider
- **Routing**: go_router 14.x
- **Ads**: AdMob (ëª¨ë°”ì¼), AdSense (ì›¹)
- **Hosting**: Cloudflare Pages
- **Repository**: https://github.com/StandardJun/Moiza.git

---

## ì™„ë£Œëœ ì‘ì—…

### 1. í”„ë¡œì íŠ¸ ì´ë¦„ ë³€ê²½ âœ…
- `study_penalty` â†’ `moiza`
- í´ë˜ìŠ¤ëª…: `StudyPenaltyApp` â†’ `MoizaApp`
- ëª¨ë“  import ë¬¸ ì—…ë°ì´íŠ¸

### 2. ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ê¸°ë°˜ ì¸ì¦ âœ…
- ì´ë©”ì¼ â†’ ì•„ì´ë””(username) ë³€ê²½
- ë‚´ë¶€ì ìœ¼ë¡œ `username@moiza.app` í˜•ì‹ìœ¼ë¡œ Firebase Auth ì‚¬ìš©
- ì•„ì´ë”” ê·œì¹™: 4-20ì, ì˜ë¬¸/ìˆ«ì/ë°‘ì¤„(_)ë§Œ í—ˆìš©
- ì¤‘ë³µ í™•ì¸ ê¸°ëŠ¥

### 3. GitHub ì—°ë™ âœ…
- ì›ê²© ì €ì¥ì†Œ: https://github.com/StandardJun/Moiza.git
- ìë™ push ê°€ëŠ¥

### 4. Cloudflare Pages ë°°í¬ ì„¤ì • âœ…
- **Build command**:
  ```
  curl -sL https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_3.29.0-stable.tar.xz | tar xJ && export PATH="$PATH:$PWD/flutter/bin" && flutter build web --release
  ```
- **Build output directory**: `build/web`
- **Framework preset**: None
- SDK ë²„ì „: `^3.5.0` (Cloudflare í˜¸í™˜)
- `firebase_options.dart` gitì— í¬í•¨ë¨

### 5. ê´‘ê³  ì‹œìŠ¤í…œ âœ… (2024-02-03 ê°œì„ )
- **ëª¨ë°”ì¼**: AdMob (google_mobile_ads)
  - AdServiceë¥¼ ChangeNotifierë¡œ ë³€ê²½í•˜ì—¬ ìƒíƒœ ë³€í™” ê°ì§€
  - BannerAdWidgetì´ ê´‘ê³  ë¡œë“œ ìƒíƒœ ì‹¤ì‹œê°„ ë°˜ì˜
  - ë¡œë”© ì¤‘ í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ
- **ì›¹**: AdSense placeholder ì¶”ê°€
  - `web/index.html`ì—ì„œ `ca-pub-XXXXXXXXXXXXXXXX` êµì²´ í•„ìš”

### 6. ì¶œì„ ì‹œìŠ¤í…œ âœ… (2024-02-03 ê³ ë„í™”)
- ì¸ì¦ ë‹¨ì–´ ë°©ì‹ (ëœë¤ í•œê¸€ ë‹¨ì–´)
- **ì¸ì¦ ë‹¨ì–´ ê¶Œí•œ**: ì¶œì„ì„ ì‹œì‘í•œ ì‚¬ëŒë§Œ ë³¼ ìˆ˜ ìˆìŒ (ë°©ì¥/ê´€ë¦¬ìë„ ì‹œì‘ì ì•„ë‹ˆë©´ ëª» ë´„)
- **ì¶œì„ ë§ˆê°/ì·¨ì†Œ ë¶„ë¦¬**:
  - ì¶œì„ ë§ˆê°: ì¶œì„ ê¸°ë¡ ì €ì¥ + ë¯¸ì¶œì„ì ê²°ì„ ì²˜ë¦¬ + ë²Œê¸ˆ ìë™ ìƒì„±
  - ì¶œì„ ì·¨ì†Œ: ì„¸ì…˜ë§Œ ì‚­ì œ (ê¸°ë¡ ì—†ìŒ)
- **ì§€ê° ìœ ì˜ˆ ì‹œê°„**: ì¶œì„ ë§ˆê° í›„ ì„¤ì •ëœ ì‹œê°„ ë‚´ ì§€ê° ì²´í¬ì¸ ê°€ëŠ¥
  - ëª¨ì„ ìƒì„± ì‹œ ì„¤ì • (ê¸°ë³¸ 10ë¶„)
  - ì–¸ì œë“  ë²Œê¸ˆ ê·œì¹™ì—ì„œ ìˆ˜ì • ê°€ëŠ¥
  - ì§€ê° ì²´í¬ì¸ ì‹œ ê²°ì„ â†’ ì§€ê°ìœ¼ë¡œ ë³€ê²½ + ë²Œê¸ˆë„ ìë™ ì¡°ì •
- ì¶œì„ ì‹œê°„ ì—°ì¥ ê¸°ëŠ¥

### 7. ê¶Œí•œ ì‹œìŠ¤í…œ âœ…
- ë°©ì¥(owner) > ê´€ë¦¬ì(admin) > ì¼ë°˜ ë©¤ë²„
- ë°©ì¥ ìœ„ì„ ê¸°ëŠ¥
- ê´€ë¦¬ì ì¶”ê°€/ì œê±°

### 8. ë²Œê¸ˆ ê·œì¹™ âœ…
- ì§€ê°, ê²°ì„, ê³¼ì œ ë¯¸ì œì¶œ ë²Œê¸ˆ ì„¤ì •
- **ì§€ê° ìœ ì˜ˆ ì‹œê°„ ì„¤ì •** (ì‹ ê·œ)
- ìˆ˜ì • ë¡œê·¸ ê¸°ë¡ ë° ì¡°íšŒ

### 9. ë¦¬ë¸Œëœë”©: ìŠ¤í„°ë”” â†’ ëª¨ì„ âœ… (2026-02-03)
- ì•± í™•ì¥ì„±ì„ ìœ„í•´ "ìŠ¤í„°ë””"ë¥¼ "ëª¨ì„"ìœ¼ë¡œ ë³€ê²½
- ë³€ê²½ëœ UI í…ìŠ¤íŠ¸:
  - `ë‚´ ìŠ¤í„°ë””` â†’ `ë‚´ ëª¨ì„`
  - `ìŠ¤í„°ë”” ì°¸ì—¬` â†’ `ëª¨ì„ ì°¸ì—¬`
  - `ìŠ¤í„°ë”” ìƒì„±` â†’ `ëª¨ì„ ìƒì„±`
  - `ìŠ¤í„°ë”” ë‚˜ê°€ê¸°` â†’ `ëª¨ì„ ë‚˜ê°€ê¸°`
- ì—ëŸ¬ ë©”ì‹œì§€, ì•± ì„¤ëª…, manifest.json, index.html ë“± ì „ì²´ ì—…ë°ì´íŠ¸
- Cloudflare Pages ë¹Œë“œ ì—ëŸ¬ ìˆ˜ì • (spread operator ë‚´ final ì„ ì–¸ ë¬¸ì œ)

### 10. UI/UX ê°œì„  âœ… (2026-02-03)
- **ì „ë¬¸ì /ë¹„ì¦ˆë‹ˆìŠ¤ ìŠ¤íƒ€ì¼ ë””ìì¸ ì ìš©**
  - ìƒˆë¡œìš´ í…Œë§ˆ ì‹œìŠ¤í…œ (ìƒ‰ìƒ, íƒ€ì´í¬ê·¸ë˜í”¼, ê°„ê²©, ê·¸ë¦¼ì)
  - ë¡œê·¸ì¸, íšŒì›ê°€ì…, í™ˆ, ëª¨ì„ ì°¸ì—¬ í™”ë©´ ê°œì„ 
- **Tab í‚¤ ìˆœì„œ ë¬¸ì œ ìˆ˜ì •**
  - íšŒì›ê°€ì… í™”ë©´ì—ì„œ Tab í‚¤ë¡œ í•„ë“œ ì´ë™ ì‹œ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ì´ë™
  - FocusNode + textInputAction ì‚¬ìš©
- **ì§€ê° ì²´í¬ì¸ ë²„ê·¸ ìˆ˜ì •**
  - `finishedAt` í•„ë“œ ì¶”ê°€í•˜ì—¬ ì¡°ê¸° ë§ˆê° ì‹œì—ë„ ì§€ê° ìœ ì˜ˆ ê¸°ê°„ ì •ìƒ ì‘ë™
- **ì¶œì„ ë§ˆê° í›„ ë°ì´í„° ë°˜ì˜ ê°œì„ **
  - ë§ˆê° í›„ 1.5ì´ˆ ëŒ€ê¸° í›„ ìë™ ìƒˆë¡œê³ ì¹¨
  - Pull-to-refresh ê¸°ëŠ¥ ì¶”ê°€
- **í…ìŠ¤íŠ¸ ìˆ˜ì •**
  - `ë©¤ë²„ë³„ ì •ì‚°` â†’ `ë©¤ë²„ë³„ ì •ì‚° í˜„í™©`

### 11. ì¶”ê°€ ê°œì„  âœ… (2026-02-03)
- **ë²Œê¸ˆ ë‚©ë¶€ ë²„íŠ¼ ì‹¤ì‹œê°„ ë°˜ì˜**
  - Optimistic update ì ìš©ìœ¼ë¡œ ë‚©ë¶€ ë²„íŠ¼ í´ë¦­ ì‹œ ì¦‰ì‹œ UI ë°˜ì˜
  - `PenaltyProvider.markAsPaid()`ì—ì„œ ë¡œì»¬ ìƒíƒœ ë¨¼ì € ì—…ë°ì´íŠ¸
- **'ì¶œì„ ì¤‘' ë°°ì§€ í‘œì‹œ ì¡°ê±´ ìˆ˜ì •**
  - ì¶œì„ ì„¸ì…˜ì´ ìˆì–´ë„ ì‹œê°„ì´ ì§€ë‚˜ë©´ 'ì¶œì„ ì¤‘' ë°°ì§€ ìˆ¨ê¹€
  - `activeAttendanceSession != null && isActive` ì¡°ê±´ìœ¼ë¡œ ë³€ê²½
- **+ ë²„íŠ¼ UI ê°œì„ **
  - ë‘ ê°œì˜ FAB â†’ í•˜ë‚˜ì˜ + ë²„íŠ¼ìœ¼ë¡œ í†µí•©
  - í´ë¦­ ì‹œ BottomSheetë¡œ "ìƒˆ ëª¨ì„ ë§Œë“¤ê¸°" / "ì´ˆëŒ€ ì½”ë“œë¡œ ì°¸ì—¬" ì„ íƒ
- **ì§€ê° ì¸ì • ì‹œê°„ ì„¤ì • UX ê°œì„ **
  - ì¶œì„ ì‹œì‘ ì‹œ ì§€ê° ì¸ì • ì‹œê°„ ì§ì ‘ ì…ë ¥ ê°€ëŠ¥
  - "ì´ ì‹œê°„ì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©" ì²´í¬ë°•ìŠ¤ë¡œ ê¸°ë³¸ê°’ ì €ì¥ ê°€ëŠ¥
  - ê¸°ì¡´: ëª¨ì„ ìƒì„¸ > ë²Œê¸ˆ ê·œì¹™ ìˆ˜ì •ì—ì„œë§Œ ì„¤ì • ê°€ëŠ¥ â†’ ì¶œì„ ì‹œì‘ ì‹œ ë°”ë¡œ ì„¤ì •
- **ë²Œê¸ˆ ì •ì‚°ì„œ ê°œì„ **
  - Pull-to-refresh ì¶”ê°€ë¡œ ê²°ì„â†’ì§€ê° ì—…ë°ì´íŠ¸ ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥
  - ë‚©ë¶€ ì²˜ë¦¬ ë²„íŠ¼: ê´€ë¦¬ì/ë°©ì¥ë§Œ í‘œì‹œ (ì¼ë°˜ ë©¤ë²„ëŠ” ìˆ¨ê¹€)

### 12. ê´‘ê³  ê¸°ëŠ¥ ì„ì‹œ ë¹„í™œì„±í™” âœ… (2026-02-04)
- **ê´‘ê³  ì™„ì „ ì œê±°** (ì¶”í›„ ì—°ë™ ì‹œ ë³µì› ì˜ˆì •)
  - `google_mobile_ads` íŒ¨í‚¤ì§€ ì£¼ì„ ì²˜ë¦¬ (pubspec.yaml)
  - `AdService` â†’ no-op í”Œë ˆì´ìŠ¤í™€ë”ë¡œ ë³€ê²½
  - ëª¨ë“  í™”ë©´ì—ì„œ `BannerAdWidget` ì œê±°
    - home_screen.dart
    - penalty_report_screen.dart
    - attendance_screen.dart
    - study_detail_screen.dart
  - `banner_ad_widget.dart` íŒŒì¼ì€ ìœ ì§€ (ì¶”í›„ ì‚¬ìš©)

### 13. ì¶œì„ ê´€ë¦¬ ê¸°ëŠ¥ ê°œì„  âœ… (2026-02-05)
- **ì¶œì„ ìƒíƒœ ìˆ˜ë™ ë³€ê²½ ê¸°ëŠ¥** (ê´€ë¦¬ì/ë°©ì¥ ì „ìš©)
  - ë²Œê¸ˆ ì •ì‚°ì„œ > ì „ì²´ ë‚´ì—­ì—ì„œ ì§€ê°/ê²°ì„ í•­ëª© ì˜† âœï¸ ë²„íŠ¼
  - ì¶œì„/ì§€ê°/ê²°ì„ ê°„ ë³€ê²½ ê°€ëŠ¥
  - ìƒíƒœ ë³€ê²½ ì‹œ ë²Œê¸ˆë„ ìë™ ì¡°ì • (ì¶œì„ìœ¼ë¡œ ë³€ê²½í•˜ë©´ ë²Œê¸ˆ ì‚­ì œ)
  - `attendance_service.dart`ì— `updateAttendanceStatus()` ì¶”ê°€
- **ë²Œê¸ˆ ê·œì¹™ ìˆ˜ì • ë‚´ì—­ ê³µê°œ**
  - ê¸°ì¡´: ê´€ë¦¬ìë§Œ ì—´ëŒ ê°€ëŠ¥ â†’ ëª¨ë“  ë©¤ë²„ ì—´ëŒ ê°€ëŠ¥
  - ëª¨ì„ ìƒì„¸ > ë²Œê¸ˆ ê·œì¹™ ì˜† ğŸ• ë²„íŠ¼
  - ê·œì¹™ ìˆ˜ì •ì€ ì—¬ì „íˆ ê´€ë¦¬ìë§Œ ê°€ëŠ¥
- **ì¶œì„ ê¸°ë¡ ì¡°íšŒ ë²„ê·¸ ìˆ˜ì •**
  - Firestore ë³µí•© ì¸ë±ìŠ¤ í•„ìš” ë¬¸ì œ í•´ê²°
  - `orderBy` ì œê±° í›„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì •ë ¬í•˜ì—¬ ì¸ë±ìŠ¤ ì—†ì´ ì‘ë™
  - `firestore.indexes.json` íŒŒì¼ ì¶”ê°€ (ì„ íƒì  ì¸ë±ìŠ¤ ì„¤ì •ìš©)

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°
```
lib/
â”œâ”€â”€ main.dart
â”œâ”€â”€ app.dart (MoizaApp)
â”œâ”€â”€ firebase_options.dart
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ constants.dart      # AdMob ID, ìƒìˆ˜
â”‚   â”œâ”€â”€ theme.dart
â”‚   â””â”€â”€ routes.dart
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user_model.dart     # username í•„ë“œ
â”‚   â”œâ”€â”€ study_group_model.dart  # lastFinishedSession ì¶”ê°€
â”‚   â”œâ”€â”€ attendance_model.dart   # sessionId ì¶”ê°€
â”‚   â””â”€â”€ penalty_model.dart
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ auth_service.dart   # ì•„ì´ë”” ê¸°ë°˜ ì¸ì¦
â”‚   â”œâ”€â”€ study_service.dart  # finishAttendanceSession, cancelAttendanceSession, lateCheckIn
â”‚   â”œâ”€â”€ attendance_service.dart
â”‚   â”œâ”€â”€ penalty_service.dart
â”‚   â””â”€â”€ ad_service.dart     # ChangeNotifierë¡œ ë³€ê²½
â”œâ”€â”€ providers/
â”‚   â””â”€â”€ study_provider.dart # finishAttendanceSession, cancelAttendanceSession, lateCheckIn
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ attendance/
â”‚   â”‚   â””â”€â”€ attendance_screen.dart  # ë§ˆê°/ì·¨ì†Œ ë¶„ë¦¬, ì§€ê° ì²´í¬ì¸ UI
â”‚   â””â”€â”€ study/
â”‚       â”œâ”€â”€ create_study_screen.dart # ì§€ê° ìœ ì˜ˆ ì‹œê°„ ì„¤ì •
â”‚       â””â”€â”€ study_detail_screen.dart # ì§€ê° ìœ ì˜ˆ ì‹œê°„ ìˆ˜ì •
â””â”€â”€ widgets/common/
    â””â”€â”€ banner_ad_widget.dart  # ê´‘ê³  ìƒíƒœ ì‹¤ì‹œê°„ ë°˜ì˜
```

---

## ë°ì´í„° ëª¨ë¸ ë³€ê²½ì‚¬í•­

### AttendanceSession
- `lateGracePeriodMinutes`: ì§€ê° ìœ ì˜ˆ ì‹œê°„ (ë¶„)
- `finishedAt`: ì‹¤ì œ ë§ˆê° ì‹œê°„ (ì¡°ê¸° ë§ˆê° ì‹œ ì‚¬ìš©)
- `userStatuses`: ì‚¬ìš©ìë³„ ì¶œì„ ìƒíƒœ (present/late)
- `isInLateGracePeriod`: ì§€ê° ìœ ì˜ˆ ê¸°ê°„ ë‚´ì¸ì§€ í™•ì¸ (finishedAt ê¸°ì¤€)
- `lateGracePeriodEndsAt`: ì§€ê° ìœ ì˜ˆ ê¸°ê°„ ì¢…ë£Œ ì‹œê°„
- `effectiveEndTime`: ì‹¤ì œ ì¢…ë£Œ ì‹œê°„ (finishedAt ?? endsAt)

### AttendanceModel
- `sessionId`: ì¶œì„ ì„¸ì…˜ ID (ì¶”ê°€)

### StudyGroupModel
- `lastFinishedSession`: ë§ˆê°ëœ ë§ˆì§€ë§‰ ì„¸ì…˜ (ì§€ê° ì²´í¬ì¸ìš©)

### PenaltyRule
- `lateGracePeriodMinutes`: ì§€ê° ìœ ì˜ˆ ì‹œê°„ (ë¶„, ê¸°ë³¸ 10ë¶„)

---

## Firebase ì„¤ì •
- **Project ID**: study-penalty
- **Auth**: Email/Password (ë‚´ë¶€ì ìœ¼ë¡œ username@moiza.app ì‚¬ìš©)
- **Firestore**: asia-northeast3
- **Web App ID**: 1:928791623594:web:e9efd22e7fc372a5c0ddd3

---

## ë‚¨ì€ ì‘ì—…

### ê´‘ê³  ì„¤ì •
- [ ] AdSense Publisher ID ì„¤ì • (`web/index.html`ì—ì„œ `ca-pub-XXXXXXXXXXXXXXXX` êµì²´)
- [ ] AdMob ì‹¤ì œ ê´‘ê³  ë‹¨ìœ„ ID ì„¤ì • (`lib/config/constants.dart`)

### ë³´ì•ˆ ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•
- [ ] Firestore ë³´ì•ˆ ê·œì¹™ ê°•í™”
- [ ] ì•± ì•„ì´ì½˜/ìŠ¤í”Œë˜ì‹œ ì»¤ìŠ¤í„°ë§ˆì´ì§•

### ì•Œë ¤ì§„ ì œí•œì‚¬í•­
- **ì›¹ í•œê¸€ ì…ë ¥ ê¹¨ì§**: Flutter Webì˜ IME ì²˜ë¦¬ í•œê³„ë¡œ í•œê¸€ ì¡°í•© ì¤‘ ê¹¨ì§ í˜„ìƒ ë°œìƒ
  - ëª¨ë°”ì¼ ë„¤ì´í‹°ë¸Œ ì•±ì—ì„œëŠ” ì •ìƒ ë™ì‘
  - ì›¹ì€ Flutter í”„ë ˆì„ì›Œí¬ ì—…ë°ì´íŠ¸ë¡œ í•´ê²° ì˜ˆì •

---

## ì‹¤í–‰ ë°©ë²•
```bash
cd "/Users/jun/Jun workstation/study_penalty"
flutter pub get
flutter run -d chrome  # ì›¹
flutter run            # ëª¨ë°”ì¼
```

---

## ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸
- ë¬´ë£Œ ì•± (ê´‘ê³  ê¸°ë°˜ - í˜„ì¬ ë¹„í™œì„±í™”)
- ë°°ë„ˆ ê´‘ê³ : í•˜ë‹¨ ìƒì‹œ ë…¸ì¶œ (ì¶”í›„)
- ì „ë©´ ê´‘ê³ : ì¶œì„ ì²´í¬ ì™„ë£Œ í›„ (ì¶”í›„)

---

## ë°°í¬ ì •ë³´

### ì›¹ ë°°í¬ (Cloudflare Pages) - ìë™ ë°°í¬
- GitHub push ì‹œ ìë™ ë¹Œë“œ ë° ë°°í¬
- URL: Cloudflare Pagesì—ì„œ í™•ì¸

### ë°°í¬ ë°©ë²•
```bash
# 1. ë³€ê²½ì‚¬í•­ ì»¤ë°‹
git add .
git commit -m "ë³€ê²½ ë‚´ìš©"

# 2. GitHub push â†’ Cloudflare ìë™ ë°°í¬
git push origin main
```

### ì•±ìŠ¤í† ì–´ ë°°í¬ ë¹„ìš©
| í”Œë«í¼ | ë¹„ìš© | ë¹„ê³  |
|--------|------|------|
| Google Play Store | $25 (ì¼íšŒì„±) | ì•½ 35,000ì› |
| Apple App Store | $99/ë…„ | ì•½ 130,000ì› |

### Firebase ë¬´ë£Œ í•œë„ (Spark Plan)
- Firestore: 50,000 ì½ê¸°/ì¼, 20,000 ì“°ê¸°/ì¼
- ì˜ˆìƒ ìˆ˜ìš©: ì¼ì¼ í™œì„± ì‚¬ìš©ì 100~200ëª…

---

## ì‘ì—… ê·œì¹™
- **ìˆ˜ì • í›„ ì¦‰ì‹œ ë°°í¬**: ì½”ë“œ ìˆ˜ì • ì™„ë£Œ ì‹œ ë°”ë¡œ git pushí•˜ì—¬ ë°°í¬ ì§„í–‰
